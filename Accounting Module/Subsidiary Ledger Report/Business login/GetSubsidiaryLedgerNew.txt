public List<VM_Voucher> GetSubsidiaryLedgerNew(int accountID, DateTime startDate, DateTime endDate)
{
    #region Get Opening Balance
    var _vchTable1 = new SqlParameter("@VoucherTable", "ACC_VoucherKH");
    var _accountID = new SqlParameter("@AccountID", accountID);
    var _tillDate = new SqlParameter("@TillDate", startDate);

    var accInfo = GetAccountByID(accountID); //db.ACC_Account.Where(x => x.AccountID == accountID).FirstOrDefault();

    string str = accInfo.AccountCode.ToString().Substring(0, 1);
    ///xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
    VM_Voucher balanceInfo = null;
    if (str == "2" || str=="4")
    {
        string SP_SQL1 = "AC_GetOpeningBalance_Offline @VoucherTable, @AccountID, @TillDate";
        balanceInfo = (db.Database.SqlQuery<VM_Voucher>(SP_SQL1, _vchTable1, _accountID, _tillDate)).FirstOrDefault();
        List<VM_Voucher> ledgerData = GetSubsidiaryLedgerForLiabilities(accountID, startDate, endDate);
        return ledgerData;
    }
    else
    {
        string SP_SQL1 = "AC_GetOpeningBalance @VoucherTable, @AccountID, @TillDate";
        balanceInfo = (db.Database.SqlQuery<VM_Voucher>(SP_SQL1, _vchTable1, _accountID, _tillDate)).FirstOrDefault();
    }
    ///xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

        //var totalDebit = balanceInfo.DebitAmount;
        //var totalCredit = balanceInfo.CreditAmount;
        var openingBalance = balanceInfo.ClosingBalance;

    if (openingBalance == null) { openingBalance = 0; }

    string balanceType = "";
    VM_Voucher openingRow = new VM_Voucher();
    openingRow.DebitAmount = 0;
    openingRow.CreditAmount = 0;
    if (openingBalance < 0)
    {
        balanceType = "Cr.";
        openingBalance = openingBalance * (-1);
        openingRow.CreditAmount = openingBalance;
    }
    else
    {
        balanceType = "Dr.";
        openingRow.DebitAmount = openingBalance;
    }


    openingRow.AccountID = accountID;
    openingRow.AccountName = accInfo.AccountName;
    openingRow.Description = "**** OPENING BALANCE ****";
    openingRow.Balance = openingBalance;
    openingRow.BalanceType = balanceType;

    #endregion

    #region Get Main Data
    var _accTable = new SqlParameter("@AccTable", "ACC_AccountKH");
    var _vchTable = new SqlParameter("@VoucherTable", "ACC_VoucherKH");
    var _accID = new SqlParameter("@AccountID", accountID);
    var _fromDate = new SqlParameter("@FromDate", startDate);
    var _toDate = new SqlParameter("@ToDate", endDate);

    string SP_SQL = "ACC_GetSubsidiaryLedgerDataNew @AccTable, @VoucherTable, @AccountID, @FromDate, @ToDate";
    var data = (db.Database.SqlQuery<VM_Voucher>(SP_SQL, _accTable, _vchTable, _accID, _fromDate, _toDate)).ToList();

    for (int i = 0; i < data.Count; i++)
    {
        if (data[i].ChequeNo == "")
        {
            data[i].ChequeDate = null;
            data[i].ChequeNo = "";
        }

        if (i == 0)
        {
            //if (balanceType == "Cr.")
            //{
            //    openingBalance = openingBalance * (-1);
            //}

            data[i].Balance = openingBalance - data[i].CreditAmount + data[i].DebitAmount;

            //if (data[i].Balance < 0)
            //{
            //    data[i].Balance = data[i].Balance * (-1);
            //    data[i].BalanceType = "Cr.";
            //}
        }
        else
        {
            //if (data[i - 1].BalanceType == "Cr.")
            //{
            //    data[i - 1].Balance = data[i - 1].Balance * (-1);
            //}

            data[i].Balance = data[i - 1].Balance - data[i].CreditAmount + data[i].DebitAmount;

            //if (data[i].Balance < 0)
            //{
            //    data[i].Balance = data[i].Balance * (-1);
            //    data[i].BalanceType = "Cr.";
            //}
            //else
            //{
            //    data[i].BalanceType = "Dr.";
            //}
        }
    }

    #endregion

    #region Set Closing Balance
    data.Insert(0, openingRow);

    var closingBalance = data[data.Count - 1].Balance;

    VM_Voucher closingRow = new VM_Voucher();

    //if (closingBalance < 0)
    //{
    //    balanceType = "Cr.";
    //    closingBalance = closingBalance * (-1);
    //}
    //else
    //{
    //    balanceType = "Dr.";
    //}

    closingRow.AccountID = accountID;
    closingRow.AccountName = accInfo.AccountName;
    closingRow.Description = "**** CLOSING BALANCE ****";
    closingRow.DebitAmount = 0;
    closingRow.CreditAmount = 0;
    closingRow.Balance = closingBalance;
    closingRow.BalanceType = balanceType;

    data.Add(closingRow);
    #endregion

    return data;
}